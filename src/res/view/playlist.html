@%'insert/playctrl.html'@
@%'insert/listsdirectory.html'@
<table id="list_table">
  <tr><th>&nbsp;<th>@label.title@</th><th>@label.performer@</th>
  <th>@label.genre@</th><th>@label.year@</th><th>&nbsp;</th>
  </tr>
  @model(
   <tr id="TR_@element.get*(ID)*@">
      <td style="width:50px" onmouseover="this.className='play_btn'" onmouseout="this.className=''" onclick="playItem(@element.get*(ID)*@, @element.get*(LIST_ID)*@)">&nbsp;</td>
      <td>@element.get*(TITLE)*@</td>
      <td>@element.get*(PERFORMER)*@</td>
      <td>@element.get*(GENRE)*@</td>
      <td>@element.get*(YEAR)*@</td>
      <td style="cursor:pointer" onclick="deleteItem(@element.get*(ID)*@, @element.get*(LIST_ID)*@)">x</td>
      </tr>
  )@
</table>

<script>
   var playState = new Object();
   
   function initFields() {
	   updatePlaylists();
	   playState.stopped = true;
   }
   
   function deleteItem(i, l) {
	   makeGenericAjaxCall('Playlist/ajax/deleteItem', 'playItem=' + i + '&playList='+l,
				true, function(res) {
		   if (res == 'Ok') {
		       var tbl = getElement('list_table');
		       var tdk = getElement('TR_'+i);
		       for(var k=0; k<tbl.rows.length; k++) {
                  if (tdk == tbl.rows[k]) {
            	     tbl.deleteRow(k) ;
            	     break;
                  }
		       }		
		   }
		}, function(err) {

			});
   }
   
   function playItem(i, l) {
	   playState.stopped = false;
	   makeGenericAjaxCall('Player', 'playItem=' + i + '&playList='+l+'&playMode=0',
		     true, function(res) {
		    	var tdk = getElement('TR_'+i);
			}, function(err) {

				});	
   }
   
   function pausePlay() { 
		top.document.title = '@label.paused@';
		playControl(2);
	}
	
	function resumePlay() {
		top.document.title = '@label.playing@';
		if (playState.stopped)
			playItem(0, '@model[0](@element.get*(LIST_ID)*@)@');
		else
			playControl(1);
	}
	
	function nextPlay() { 
		playControl(0);
	}
	
	function stopPlay() { 
		playControl(4);
		playState.stopped = true;
		top.document.title = '@label.stopped@';
	}
</script>